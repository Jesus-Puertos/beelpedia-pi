---
import Layout from "@/layouts/Layout.astro";
import team from "@/data/team.json";
import { supabase } from "@/lib/supabase";

let user = null;
let profile = null;
let displayName = null;
let avatar = null;

const { data: { session } } = await supabase.auth.getSession();

if (session) {
  user = session.user;

  const { data: profileData } = await supabase
    .from("profiles")
    .select("nombre, avatar_url")
    .eq("id", user.id)
    .single();

  profile = profileData;
  displayName = profile?.nombre ?? "Usuario";
  avatar = profile?.avatar_url ?? "/default-avatar.webp";
}
---

<Layout user={user} avatar={avatar} displayName={displayName}>
  <section class="py-20 bg-emerald-50">
    <div class="max-w-screen-xl mx-auto px-4 md:px-8">
      <!-- Encabezado -->
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-emerald-800 sm:text-4xl">
          Nuestro equipo
        </h2>
        <p class="mt-3 text-emerald-700">
          Detr치s de esta plataforma cultural trabajamos con pasi칩n por la tecnolog칤a,
          la innovaci칩n y la preservaci칩n de nuestro patrimonio.
        </p>
      </div>

      <!-- Grid de integrantes -->
      <ul class="mt-16 grid gap-12 sm:grid-cols-2 lg:grid-cols-3">
        {team.map((item) => (
          <li class="flex flex-col items-center text-center p-6 bg-white shadow-lg rounded-2xl border border-emerald-200 hover:shadow-xl transition">
            <div class="w-32 h-32">
              <img
                src={item.avatar}
                alt={`Foto de ${item.name}`}
                class="w-full h-full rounded-full object-cover border-4 border-emerald-500 shadow-md"
              />
            </div>
            <h4 class="mt-6 text-xl font-semibold text-emerald-900">{item.name}</h4>
            <p class="text-emerald-600 font-medium">{item.title}</p>
            <p class="mt-3 text-emerald-700 text-sm leading-relaxed">{item.desc}</p>

            <!-- Redes sociales -->
            <div class="mt-4 flex gap-5 text-emerald-600 text-xl">
              <a href={item.twitter} aria-label={`Twitter de ${item.name}`} class="hover:text-emerald-800 transition">游냕</a>
              <a href={item.github} aria-label={`GitHub de ${item.name}`} class="hover:text-emerald-900 transition">游눹</a>
              <a href={item.linkedin} aria-label={`LinkedIn de ${item.name}`} class="hover:text-emerald-700 transition">游댕</a>
            </div>
          </li>
        ))}
      </ul>
    </div>
  </section>
</Layout>
