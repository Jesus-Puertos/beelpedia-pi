---
import Layout from "@/layouts/Layout.astro";
import { supabase } from "@/lib/supabase";

let user = null;
let profile = null;

const { data: { session } } = await supabase.auth.getSession();

if (session?.user) {
  user = session.user;
  const { data } = await supabase
    .from("profiles")
    .select("nombre, apellidos, telefono, avatar_url, bio")
    .eq("id", user.id)
    .single();
  profile = data;
}
---

<Layout user={user} displayName={profile?.nombre} avatar={profile?.avatar_url}>
  <section class="max-w-4xl mx-auto mt-8 px-4">
    <!-- Cover -->
    <div class="relative rounded-xl shadow">
      <img
        src="https://images.unsplash.com/photo-1503264116251-35a269479413"
        alt="Portada"
        class="w-full h-48 object-cover"
      />

      
<div class="absolute w-full -bottom-16 md:-bottom-12 flex flex-col items-center md:flex-row md:justify-start md:space-x-4">
        <img
          id="avatar-preview"
          src={profile?.avatar_url ?? "/default-avatar.webp"}
          alt="Avatar"
          class="h-24 w-24 rounded-full border-4 border-white shadow-md object-cover"
        />
        <div class="bg-white  w-full p-4 shadow rounded-md text-black">
          <h1 class="text-xl font-bold ">
           {profile?.nombre} {profile?.apellidos}
          </h1>
         

          <p class="text-gray-700">
  {profile?.bio ?? "Aquí puedes escribir una pequeña biografía, descripción o intereses culturales del usuario."}
</p>

        </div>
        <a href="/perfil/editar" class="px-4 py-2 rounded-lg bg-emerald-600 text-white font-medium hover:bg-emerald-500">
          Editar 
        </a>
      </div>
      
    </div>

    <div class="mt-16 bg-white dark:bg-emerald-900 border rounded-xl shadow p-6">
     

      <!-- Stats -->
      <div class="grid grid-cols-3 text-center mt-6 border-t pt-6">
        <div>
          <p class="font-bold text-lg text-emerald-700">127</p>
          <span class="text-sm text-gray-500">Posts</span>
        </div>
        <div>
          <p class="font-bold text-lg text-emerald-700">2.8k</p>
          <span class="text-sm text-gray-500">Seguidores</span>
        </div>
        <div>
          <p class="font-bold text-lg text-emerald-700">45</p>
          <span class="text-sm text-gray-500">Destinos</span>
        </div>
      </div>

      <!-- Acciones -->
      <div class="flex flex-wrap justify-center gap-3 mt-6">
        <button class="px-4 py-2 rounded-lg bg-emerald-600 text-white font-medium hover:bg-emerald-500">
          Seguir
        </button>
        <button class="px-4 py-2 rounded-lg border text-emerald-700 dark:text-emerald-300">
          Mensaje
        </button>
        <button class="px-4 py-2 rounded-lg border text-emerald-700 dark:text-emerald-300">
          Compartir
        </button>
      </div>

      <!-- Tabs -->
      <div class="flex justify-around mt-8 border-b">
        <button class="py-2 px-4 font-medium text-emerald-700 border-b-2 border-emerald-600">
          Posts
        </button>
        <button class="py-2 px-4 font-medium text-gray-500 hover:text-emerald-600">
          Destinos
        </button>
        <button class="py-2 px-4 font-medium text-gray-500 hover:text-emerald-600">
          Insignias
        </button>
      </div>
    </div>
  </section>
</Layout>
